<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>Amplishot by ctSkennerton</title>

    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/pygment_trac.css">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="wrapper">
      <header>
        <h1>Amplishot</h1>
        <p>Amplicon-Shotgun</p>

        <p class="view"><a href="https://github.com/ctSkennerton/Amplishot">View the Project on GitHub <small>ctSkennerton/Amplishot</small></a></p>


        <ul>
          <li><a href="https://github.com/ctSkennerton/Amplishot/zipball/master">Download <strong>ZIP File</strong></a></li>
          <li><a href="https://github.com/ctSkennerton/Amplishot/tarball/master">Download <strong>TAR Ball</strong></a></li>
          <li><a href="https://github.com/ctSkennerton/Amplishot">View On <strong>GitHub</strong></a></li>
        </ul>
      </header>
      <section>
        <h1>
<a name="amplishot-amplicon-shotgun" class="anchor" href="#amplishot-amplicon-shotgun"><span class="octicon octicon-link"></span></a>Amplishot: Amplicon-Shotgun</h1>

<p>Currently microbial community profiling sudies rutienly use 454
pyrosequencing to generate 10,000 - 100,000 reads from particular 
variable regions of the 16S rRNA gene.  Unfortunately 454 pyrosequencing 
has a number of short falls such as homopolymer errors.  Furthermore
taxonomic resolution can be lost when using 454 pyrosequencing due
to the smaller fragment of the 16S rRNA gene that is being analyzed.
<em>Amplishot</em> combines amplification of the full 16S rRNA gene sequence
with <em>de novo</em> reconstruction of full-length 16S rRNA genes from specially
constructed "Amplishot" Illumina sequencing libraries or from
metagenomes. </p>

<h2>
<a name="dependancies" class="anchor" href="#dependancies"><span class="octicon octicon-link"></span></a>Dependancies</h2>

<ul>
<li>
<a href="http://qiime.org">Qiime</a> - tested only on version 1.6.0 &amp; 1.8.0</li>
<li>  <a href="http://bowtie-bio.sourceforge.net/bowtie2/index.shtml">bowtie2</a> - tested with version 2.0.5</li>
<li><a href="http://www.exelixis-lab.org/pear">Pear</a></li>
<li><a href="http://pyyaml.org/">pyYAML</a></li>
<li>numpy</li>
</ul><h2>
<a name="otu-clustering-dependancies" class="anchor" href="#otu-clustering-dependancies"><span class="octicon octicon-link"></span></a>OTU Clustering Dependancies</h2>

<ul>
<li>  <a href="http://cd-hit.org">cd-hit</a> - tested with 4.5.4</li>
<li>uclust - now packaged with Qiime if using version 1.8.0 or higher.
NOTE: uclust is not the same as usearch although google searches for
the former will return the latter</li>
</ul><h3>
<a name="assembly-dependancies" class="anchor" href="#assembly-dependancies"><span class="octicon octicon-link"></span></a>Assembly Dependancies</h3>

<p>You must have one of the following</p>

<ul>
<li>  <a href="http://www.phrap.org/">phrap</a> - tested with version 1.09518 (not
currently recomented as it does not scale)</li>
<li>
<a href="http://denovoassembler.sourceforge.net/">Ray</a> - tested with version 2.3.1</li>
<li><a href="https://www.ebi.ac.uk/%7Ezerbino/velvet/">velvet</a></li>
</ul><h2>
<a name="installation" class="anchor" href="#installation"><span class="octicon octicon-link"></span></a>Installation</h2>

<p>You can either download the <a href="https://github.com/ctSkennerton/Amplishot">latest source code</a>
 or a <a href="https://github.com/ctSkennerton/Amplishot/tags">particular version</a> from github.
Once downloaded change into the Amplishot directory and run the following:</p>

<pre><code> [sudo] python setup.py install
</code></pre>

<p>or if you do not have sudo on your computer use the <code>--prefix</code> option to change
the installation directory.</p>

<h2>
<a name="command-line-interface" class="anchor" href="#command-line-interface"><span class="octicon octicon-link"></span></a>Command-line interface</h2>

<p>Amplishot has a single executable called <code>amplishot</code>; you can see some basic help
by running the command <code>amplishot -h</code>.
The command-line options for Amplishot only offer a subset of the options that are 
available.  Most options are changed by using a configuration file.  The Amplishot 
configuration file is written in <a href="http://yaml.org">YAML</a>, which is a simple markup 
language; before you try to modify the configuration file it might be helpful to 
read up on the YAML <a href="http://yaml.org/spec/1.1/">syntax</a>.
Command-line options and a configuration file can be used in tandum.  Any options
specified on the command-line will <strong>overwrite</strong> the corresponding value in the
configuration file.  If changes have been made to a configuration by using 
command-line options, a new configuration file will be outputted to the global
output directory with a datetime signature so that no previous configuration details
are lost.  A new configuration file will not be outputted if there are no changes
to the current configuration set.</p>

<h3>
<a name="configuration-options-and-their-values" class="anchor" href="#configuration-options-and-their-values"><span class="octicon octicon-link"></span></a>Configuration options and their values</h3>

<ul>
<li>  <code>threads</code>: Sets the number of threads/processes to use in the Amplishot pipeline. 
The value should be a single integer number (default: 1)</li>
<li>  <code>log_level</code>: Changes the verbosity of logging messages.  The options from most 
verbose to least are: DEBUG, INFO, WARN, ERROR, CRITICAL (default: INFO)</li>
<li>  <code>output_directory</code>: This is the directory where all results will be outputted.<br>
By default it is the current directory, symbolized by a '.' character</li>
<li>
<p><code>input_raw_reads</code>: This must be a list of files raw Illumina sequencing read files
to input into Amplishot.  The format of the input reads must be a <em>list-of-lists</em>,
which can be added to the configuration in two ways:</p>

<pre><code>input_raw_reads:
    - [/full/path/to/sample1.1.fq, /full/path/to/sample1.2.fq]
    - [/full/path/to/sample2.1.fq, /full/path/to/sample2.2.fq]

input_raw_reads:
    - 
        - /full/path/to/sample1.1.fq
        - /full/path/to/sample1.2.fq
    -
        - /full/path/to/sample2.1.fq
        - /full/path/to/sample2.2.fq
</code></pre>
</li>
<li>
<p><code>aliases</code>: Use this option to set the sample names to be used in the output files.
By default the filename is used without the file extension.  The form of the values
must be a YAML list specified by either:</p>

<pre><code>aliases:
    - alias1
    - alias2

aliases: [alias1, alias2]
</code></pre>
</li>
<li><p><code>skip_pairtigs</code>: specify true or false whether you would like to
assemble paired reads first before mapping onto the reference 16S rDNA
database. This option is highly recomended for samples that are from
full metagenomes that will likely be mostly from non-rDNA source</p></li>
<li>  <code>minimum_pairtig_length</code>: Specify the minimum length that pairtigs must be.  This 
option has no effect if the <code>pairtig_read_files</code> option is set. (default: 350)</li>
<li>  <code>pair_overlap_length</code>: The minimum number of nucleotides that two reads from a 
pair must overlap by to generate a pairtig. (default: 30)</li>
<li>  <code>mapper</code>: The name of the short read aligner used in Amplishot.  Currently only
bowtie2 is implemented and therefore the only valid value for this option is
bowtie</li>
<li>  <code>mapper_database</code>: Give the <strong>full</strong> filepath to an index file generated by the
short read mapper</li>
<li>  <code>taxonomy_file</code>: the name of the file containing a mapping between the reference
sequences and their taxon strings</li>
<li>  <code>mapping_similarity_cutoffs</code>: A list of required similarity between a reference sequence
and a pairtig. Reads will be segregated into a band of similarity
and assembled separately in that band </li>
<li>  <code>taxon_coverage</code>: list of two integer numbers that determine whether there are 
enough reads for assembly.  The first number must be the minimum coverage (vertical
read depth) for a taxon; the second number is the number of bases that must 
contain the minimum coverage. (default: [2, 1000])</li>
<li>  <code>assembly_method</code>: <em>de novo</em> 16S reconstruction method.  The only valid
values are <code>phrap</code>, <code>ray</code> and  <code>velvet</code>
</li>
<li>  <code>minimum_reconstruction_length</code>: minimum length of sequences that are defined 
as 'full length' and used in taxonomic assignment.</li>
<li>  <code>otu_clustering_method</code>: Currently the only valid value is <code>cdhit</code>
</li>
<li>  <code>otu_clustering_similarity</code>: the similarity used for clustering full-length 
sequences from different samples into OTUs </li>
<li>
<code>neighbours_file</code>: A file that calculate the phylogenetic distanse
between two separate reference sequences</li>
</ul><h3>
<a name="program-related-blocks" class="anchor" href="#program-related-blocks"><span class="octicon octicon-link"></span></a>Program related blocks</h3>

<p>Some of the underlying programs used in Amplishot can be controlled precisely by
specifying a <em>block</em> in the configuration file containing options specific 
to that program.  Each of these blocks is specified with a key that is identical
to the program name; within each block are program specific key-value pairs.<br>
The program specific key-value pairs must be indented by 4 spaces ( <strong>not tabs</strong> ),
this indentation must be consistent throughout the entire configuration file.
Currently program related blocks are available for both the assembly and 
taxonomy assignment parts of Amplishot</p>

<h4>
<a name="assembly" class="anchor" href="#assembly"><span class="octicon octicon-link"></span></a>Assembly</h4>

<h5>
<a name="phrap" class="anchor" href="#phrap"><span class="octicon octicon-link"></span></a>Phrap</h5>

<p>Specify extra options
using the <code>phrap</code> key.  Any of the command-line options available in phrap 
(listed <a href="http://www.phrap.org/phredphrap/phrap.html">here</a>) can be used as the keys
in the phrap block, however you must not add in the dash (-) prefix for the options.
For example to modify stringency of the assembly, you could change the scoring matrix:</p>

<pre><code>phrap:
    penalty: -9
    gap_ext: -11
    gap_init: -12
    minscore: 350
</code></pre>

<p>Just because you can do this does not mean that you should unless you know exactly
what you are doing or are experimenting when Amplishot is producing sub-standard
results.  The scoring matrix and other assembly parameters used in phrap have 
already been altered to generate accurate 16S assemblies, so the default
settings should work well.</p>

<h4>
<a name="taxonomy-assignment" class="anchor" href="#taxonomy-assignment"><span class="octicon octicon-link"></span></a>Taxonomy Assignment</h4>

<p>Taxonomy assignment is handled in Amplishot after the reconstruction of full-length
16S sequences has occurred.  There are a number of different methods for taxonomic
assignment that include some of those available in Qiime 1.6.0. The taxonomy 
assignment method is determined from the Amplishot configuration file with the
<code>assign_taxonomy_method</code> key.  By default the Bowtie2 taxonomy assigner is used.
The valid values for each classifier are shown below:</p>

<ul>
<li>
<code>bowtie</code> for bowtie2 based assigner</li>
<li>
<code>blast</code> for Qiime blastall based assigner </li>
<li>
<code>rdp</code> for RDP classifier</li>
<li>
<code>mothur</code> for Mothur classifier</li>
</ul><h4>
<a name="configuration-file-options" class="anchor" href="#configuration-file-options"><span class="octicon octicon-link"></span></a>Configuration File options</h4>

<p>For all taxonomy assigners a special block can be given in the configuration file
for specific options.  The key to this block must be the same as the value of 
the <code>assign_taxonomy_method</code> key.  For example to use the blast taxon assigner the
following code could be added into the configuration file:</p>

<pre><code>assign_taxonomy_method: blast
blast:
    evalue: 1e-50
    blast_db: /full/path/to/blast/database
</code></pre>

<h4>
<a name="options-specific-to-all-taxon-assigners" class="anchor" href="#options-specific-to-all-taxon-assigners"><span class="octicon octicon-link"></span></a>Options specific to all taxon assigners</h4>

<ul>
<li>
<code>id_to_taxonomy_fp</code>: <strong>Full</strong> path to file containing a mapping between reference
sequences and their respective taxon strings.  By default all taxon assigners will
use the  value of the <code>taxonomy_file</code> key.  This option should only be used if 
different reference sequence set is being used for taxonomy assignment </li>
<li>
<code>reference_sequences_fp</code>: <strong>Full</strong> path to file containing reference sequences</li>
</ul><h5>
<a name="bowtie" class="anchor" href="#bowtie"><span class="octicon octicon-link"></span></a>Bowtie</h5>

<ul>
<li>
<code>index</code>: <strong>Full</strong> file path to bowtie2 formatted index file for the reference sequences.<br>
By default the bow tie taxonomic assigner will use the value of the <code>mapper_database</code> 
key, however a different database file can be accessed  here for taxonomic assignment</li>
<li>
<code>threads</code>: specify the number of threads that bowtie can use </li>
<li>
<code>percentId</code>: The minimum percent identity that a representative sequence must map with, 
any sequence below this threshold will not be given a taxonomy</li>
</ul><h5>
<a name="blast" class="anchor" href="#blast"><span class="octicon octicon-link"></span></a>Blast</h5>

<ul>
<li>
<code>blast_db</code>: <strong>Full</strong> file path to the file containing the blast database that must
be formatted using the <code>formatdb</code> utility for nucleotide sequences.  Do <strong>not</strong> add in
the file extensions usually associated with blast databases. e.g. <code>.nsq</code>, <code>.nin</code> etc.</li>
<li>
<code>evalue</code>: The maximum allowable e-value allowed for a given match.  If no match can
be found below this score, then a representative sequence will not be given a
taxonomic assignment.</li>
</ul><h5>
<a name="mothur" class="anchor" href="#mothur"><span class="octicon octicon-link"></span></a>Mothur</h5>

<ul>
<li>
<code>Confidence</code>: Minimum allowed confidence score for taxonomic assignment</li>
</ul><h5>
<a name="rdp" class="anchor" href="#rdp"><span class="octicon octicon-link"></span></a>RDP</h5>

<ul>
<li>
<code>Confidence</code>: Minimum allowed confidence score allowed for taxonomic assignment</li>
<li>
<code>max_memory</code>: Set the maximum memory allowed for the RDP java virtual machine</li>
<li>
<code>training_data_properties_fp</code>: <strong>Full</strong> path to a file containing pre-compiled 
training data.<br>
This option is overridden if both the <code>reference_sequences_fp</code> and 
<code>id_to_taxonomy_fp</code> keys are set.</li>
</ul><h3>
<a name="example-configuration-file" class="anchor" href="#example-configuration-file"><span class="octicon octicon-link"></span></a>Example Configuration file</h3>

<pre><code>---
threads: 5
log_level: INFO
minimum_pairtig_length: 350 # minimum length of the overlapped pairs
pair_overlap_length: 30 # mimimum length of the overlap
mapper: bowtie # program used for read mapping 
mapping_similarity_cutoffs: [0.85, 0.90, 0.95, 0.98] # the sequence similarity required between the reference database and the reads
taxon_coverage: [2, 1000] # list of two numbers. The first is the minimum coverage, the second is the number of bases that need to be covered
assembly_method: ray # choose a genome assembler  
minimum_reconstruction_length: 1000 # minimum length of sequences that we define as 'full length'
otu_clustering_method: cdhit
otu_clustering_similarity: 0.97 # the similarity used for clustering full-length sequences from different samples into OTUs
read_mapping_percent: 0.90 # the percent identity that individual reads have to map with to be considered part of the reference
assign_taxonomy_method: blast
minimum_taxon_similarity: 0.90 # sequences that fall below this cutoff will be listed as no taxonomy
blast_db: '/srv/whitlam/bio/db/gg/from_www.secongenome.com/2012_10/gg_12_10_otus/rep_set/99_otus.fasta'
</code></pre>

<h3>
<a name="tips-for-writing-config-files" class="anchor" href="#tips-for-writing-config-files"><span class="octicon octicon-link"></span></a>Tips for writing config files</h3>

<p>Writing out the full file path names in the configuration file can be a
real pain.  However you can reduce the burden on yourself by taking
advantage of some of the advanced features in the <code>vim</code> text editor.
When in <code>INSERT</code> mode if you start typing a file path (like <code>~/</code>) and
then press CTRL-x CTRL-f, you'll get a popup menu of file paths!! You
can use this to quickly add in file names to your config file. </p>
      </section>
      <footer>
        <p>This project is maintained by <a href="https://github.com/ctSkennerton">ctSkennerton</a></p>
        <p><small>Hosted on GitHub Pages &mdash; Theme by <a href="https://github.com/orderedlist">orderedlist</a></small></p>
      </footer>
    </div>
    <script src="javascripts/scale.fix.js"></script>
    
  </body>
</html>